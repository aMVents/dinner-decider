<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinner Decider</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .main-button {
            width: 100%;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 20px;
        }

        .main-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .main-button:active {
            transform: translateY(0);
        }

        .result {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 12px;
            margin: 20px 0;
            display: none;
        }

        .result.show {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result h2 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .result .country {
            color: rgba(255,255,255,0.9);
            font-size: 1.2em;
        }

        .secondary-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 20px;
            font-size: 1em;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .btn:hover {
            background: #667eea;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-country-toggle {
            margin-top: 10px;
            font-size: 0.9em;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .dinner-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .dinner-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .dinner-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .dinner-info .country-tag {
            display: inline-block;
            padding: 4px 12px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #ff3838;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .country-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .country-filter {
            padding: 8px 16px;
            background: #e0e0e0;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }

        .country-filter.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #999;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üçΩÔ∏è Dinner Decider</h1>
            
            <button class="main-button" id="decideBtn">What's for Dinner?</button>
            
            <div class="result" id="result">
                <h2 id="dinnerName"></h2>
                <div class="country" id="dinnerCountry"></div>
            </div>

            <div class="secondary-buttons">
                <button class="btn" id="addBtn">‚ûï Add Dinner</button>
                <button class="btn" id="viewBtn">üìã View List</button>
            </div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">Total Dinners</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="countryCount">0</div>
                    <div class="stat-label">Cuisines</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Dinner Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Dinner</h2>
                <button class="close-btn" id="closeAddModal">‚úï</button>
            </div>
            <form id="addForm">
                <div class="form-group">
                    <label for="countrySelect">Cuisine</label>
                    <select id="countrySelect">
                        <option value="">Select a cuisine...</option>
                    </select>
                    <div class="add-country-toggle" id="toggleCountryInput">+ Add a cuisine</div>
                    <input type="text" id="newCountryInput" placeholder="Enter new cuisine name" style="display: none; margin-top: 10px;">
                </div>
                <div class="form-group">
                    <label for="dinnerName">Dinner Name</label>
                    <input type="text" id="dinnerNameInput" placeholder="e.g., Spaghetti Bolognese" required>
                </div>
                <button type="submit" class="main-button">Add to List</button>
            </form>
        </div>
    </div>

    <!-- View List Modal -->
    <div class="modal" id="viewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Dinner List</h2>
                <button class="close-btn" id="closeViewModal">‚úï</button>
            </div>
            <div class="filter-section">
                <label>Filter by Cuisine:</label>
                <div class="country-filters" id="countryFilters"></div>
            </div>
            <div class="dinner-list" id="dinnerList"></div>
        </div>
    </div>

    <script>
        // Storage key
        const STORAGE_KEY = 'dinners';
        
        // Initialize data structure
        let dinners = [];
        let selectedFilter = 'all';

        // Check if we have Claude's persistent storage or fall back to localStorage
        const hasClaudeStorage = typeof window.storage !== 'undefined';

        // Load data from storage
        async function loadDinners() {
            try {
                if (hasClaudeStorage) {
                    const result = await window.storage.get(STORAGE_KEY);
                    if (result && result.value) {
                        dinners = JSON.parse(result.value);
                    } else {
                        dinners = [];
                    }
                } else {
                    // Fallback to localStorage
                    const stored = localStorage.getItem(STORAGE_KEY);
                    if (stored) {
                        dinners = JSON.parse(stored);
                    } else {
                        dinners = [];
                    }
                }
            } catch (error) {
                console.log('No existing dinners found, starting fresh', error);
                dinners = [];
            }
            updateStats();
            updateCountrySelect();
        }

        // Save data to storage
        async function saveDinners() {
            try {
                if (hasClaudeStorage) {
                    await window.storage.set(STORAGE_KEY, JSON.stringify(dinners));
                } else {
                    // Fallback to localStorage
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(dinners));
                }
                updateStats();
                updateCountrySelect();
            } catch (error) {
                console.error('Error saving dinners:', error);
                alert('Failed to save dinner. Please try again. Error: ' + error.message);
            }
        }

        // Get unique countries
        function getCountries() {
            const countries = [...new Set(dinners.map(d => d.country))];
            return countries.sort();
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalCount').textContent = dinners.length;
            document.getElementById('countryCount').textContent = getCountries().length;
        }

        // Update country dropdown
        function updateCountrySelect() {
            const select = document.getElementById('countrySelect');
            const countries = getCountries();
            
            select.innerHTML = '<option value="">Select a cuisine...</option>';
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                select.appendChild(option);
            });
        }

        // Decide what's for dinner
        document.getElementById('decideBtn').addEventListener('click', () => {
            if (dinners.length === 0) {
                alert('No dinners in your list yet! Add some first.');
                return;
            }

            const randomIndex = Math.floor(Math.random() * dinners.length);
            const dinner = dinners[randomIndex];
            
            document.getElementById('dinnerName').textContent = dinner.name;
            document.getElementById('dinnerCountry').textContent = `üåç ${dinner.country}`;
            
            const resultDiv = document.getElementById('result');
            resultDiv.classList.remove('show');
            setTimeout(() => resultDiv.classList.add('show'), 10);
        });

        // Show add modal
        document.getElementById('addBtn').addEventListener('click', () => {
            document.getElementById('addModal').classList.add('show');
        });

        // Close add modal
        document.getElementById('closeAddModal').addEventListener('click', () => {
            document.getElementById('addModal').classList.remove('show');
            document.getElementById('addForm').reset();
            document.getElementById('newCountryInput').style.display = 'none';
        });

        // Toggle country input
        document.getElementById('toggleCountryInput').addEventListener('click', () => {
            const input = document.getElementById('newCountryInput');
            const select = document.getElementById('countrySelect');
            if (input.style.display === 'none') {
                input.style.display = 'block';
                select.disabled = true;
                input.focus();
            } else {
                input.style.display = 'none';
                select.disabled = false;
                input.value = '';
            }
        });

        // Add dinner form submission
        document.getElementById('addForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const countrySelect = document.getElementById('countrySelect');
            const newCountryInput = document.getElementById('newCountryInput');
            const dinnerNameInput = document.getElementById('dinnerNameInput');
            
            const country = newCountryInput.style.display === 'block' 
                ? newCountryInput.value.trim()
                : countrySelect.value;
            
            const name = dinnerNameInput.value.trim();
            
            if (!country || !name) {
                alert('Please fill in all fields');
                return;
            }
            
            dinners.push({ name, country, id: Date.now() });
            await saveDinners();
            
            // Reset form properly
            document.getElementById('addForm').reset();
            document.getElementById('newCountryInput').style.display = 'none';
            document.getElementById('countrySelect').disabled = false;
            
            // Update dropdown to show new cuisine
            updateCountrySelect();
            
            document.getElementById('addModal').classList.remove('show');
            
            alert('Dinner added successfully!');
        });

        // Show view modal
        document.getElementById('viewBtn').addEventListener('click', () => {
            renderCountryFilters();
            renderDinnerList();
            document.getElementById('viewModal').classList.add('show');
        });

        // Close view modal
        document.getElementById('closeViewModal').addEventListener('click', () => {
            document.getElementById('viewModal').classList.remove('show');
        });

        // Render country filters
        function renderCountryFilters() {
            const container = document.getElementById('countryFilters');
            const countries = getCountries();
            
            container.innerHTML = '';
            
            // Add "All" filter
            const allFilter = document.createElement('div');
            allFilter.className = 'country-filter' + (selectedFilter === 'all' ? ' active' : '');
            allFilter.textContent = 'All';
            allFilter.addEventListener('click', () => {
                selectedFilter = 'all';
                renderCountryFilters();
                renderDinnerList();
            });
            container.appendChild(allFilter);
            
            // Add country filters
            countries.forEach(country => {
                const filter = document.createElement('div');
                filter.className = 'country-filter' + (selectedFilter === country ? ' active' : '');
                filter.textContent = country;
                filter.addEventListener('click', () => {
                    selectedFilter = country;
                    renderCountryFilters();
                    renderDinnerList();
                });
                container.appendChild(filter);
            });
        }

        // Render dinner list
        function renderDinnerList() {
            const container = document.getElementById('dinnerList');
            
            const filteredDinners = selectedFilter === 'all' 
                ? dinners 
                : dinners.filter(d => d.country === selectedFilter);
            
            if (filteredDinners.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No dinners found</p></div>';
                return;
            }
            
            container.innerHTML = '';
            filteredDinners.forEach(dinner => {
                const item = document.createElement('div');
                item.className = 'dinner-item';
                item.innerHTML = `
                    <div class="dinner-info">
                        <h3>${dinner.name}</h3>
                        <span class="country-tag">${dinner.country}</span>
                    </div>
                    <button class="delete-btn" data-id="${dinner.id}">Delete</button>
                `;
                container.appendChild(item);
            });
            
            // Add delete listeners
            container.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const id = parseInt(e.target.dataset.id);
                    if (confirm('Are you sure you want to delete this dinner?')) {
                        dinners = dinners.filter(d => d.id !== id);
                        await saveDinners();
                        renderCountryFilters();
                        renderDinnerList();
                    }
                });
            });
        }

        // Close modals on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });

        // Initialize app
        loadDinners();
    </script>
</body>
</html>
